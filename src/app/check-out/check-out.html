<div class="container mt-4">
  <h1 class="mb-4">Checkout</h1>

  <div class="row">
    <div class="col-md-8">
      <form [formGroup]="checkoutForm" (ngSubmit)="onSubmit()">
        <app-shipping-form [form]="checkoutForm"></app-shipping-form>

        <div class="mb-3">
          <label>Payment Information</label>
          <div id="card-element" class="form-control" style="padding: 10px;"></div>
@if (checkoutForm.get('paymentMethod')?.invalid && checkoutForm.get('paymentMethod')?.touched) {
  <div class="invalid-feedback">
    Please provide valid payment information.
  </div>
}
        </div>

        <button class="btn btn-primary" type="submit" [disabled]="checkoutForm.invalid || isProcessing">
          {{ isProcessing ? 'Processing...' : 'Complete Order' }}
        </button>
      </form>
    </div>

    <div class="col-md-4">
      <h4>Your cart</h4>
      <ul class="list-group">
        @for (item of cart?.items | keyvalue; track item.key) {
          <li class="list-group-item">
            {{ item.value.product.title }} - Quantity: {{ item.value.quantity }} - ${{ (item.value.product.price * item.value.quantity).toFixed(2) }}
          </li>
        }
        <li class="list-group-item">
          <strong>Total: ${{ getTotalPrice().toFixed(2) }}</strong>
        </li>
      </ul>
    </div>
  </div>
</div>
